name: Ubuntu VNC

on: [workflow_dispatch]

jobs:
  ubuntu-vnc:
    runs-on: ubuntu-latest
    steps:
      - name: Prepare and install packages
        run: |
          sudo apt-get update
          sudo DEBIAN_FRONTEND=noninteractive apt-get install -y \
            xfce4 xfce4-goodies tightvncserver git wget curl

      - name: Configure VNC
        run: |
          vncserver :1
          vncserver -kill :1
          mkdir -p ~/.vnc
          echo "#!/bin/bash
          xrdb \$HOME/.Xresources
          startxfce4 &" > ~/.vnc/xstartup
          chmod +x ~/.vnc/xstartup
          vncserver :1 -geometry 1280x720 -depth 24

      - name: Install and Launch noVNC
        run: |
          git clone https://github.com/novnc/noVNC.git ~/noVNC
          git clone https://github.com/novnc/websockify ~/noVNC/utils/websockify
          nohup ~/noVNC/utils/launch.sh --vnc localhost:5901 --listen 6080 &
          sleep 5
          curl -s https://serveo.net > /dev/null || echo "Serveo may be down"
          nohup ssh -o StrictHostKeyChecking=no -R 80:localhost:6080 serveo.net &
